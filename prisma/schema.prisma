// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Evento {
  id          String   @id @default(cuid())
  nome        String
  descricao   String?
  data        DateTime
  local       String
  cidade      String   @default("Manaus")
  imagemUrl   String?
  ativo       Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  ingressos   Ingresso[]
  
  @@map("eventos")
}

model Ingresso {
  id          String   @id @default(cuid())
  eventoId    String
  tipo        String   // Ex: "Pista", "VIP", "Camarote"
  preco       Float
  quantidade  Int      @default(0)
  vendidos    Int      @default(0)
  kit         String?  // Descrição do kit incluído no ingresso (nome do elemento, quantidade, observações)
  ativo       Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  evento      Evento   @relation(fields: [eventoId], references: [id], onDelete: Cascade)
  vendas      Venda[]
  
  @@map("ingressos")
}

model Cliente {
  id          String   @id @default(cuid())
  nome        String
  email       String   @unique
  telefone    String?
  cpf         String?  @unique
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  vendas      Venda[]
  notificacoes Notificacao[]
  
  @@map("clientes")
}

model Venda {
  id             String   @id @default(cuid())
  clienteId      String
  ingressoId     String
  quantidade     Int
  valorTotal     Float
  formaPagamento String   @default("pix") // pix, cartao_credito, cartao_debito, boleto
  statusPagamento String @default("pendente") // pendente, processando, confirmado, cancelado, expirado
  status         String   @default("pendente") // pendente, confirmada, cancelada
  codigo         String   @unique
  codigoPagamento String? // Código PIX, código de barras do boleto, ID da transação
  qrCodePix      String?  // QR Code em base64 para PIX
  vencimentoBoleto DateTime? // Data de vencimento do boleto
  dadosCartao    String?  // JSON com últimos 4 dígitos e bandeira (criptografado)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  cliente        Cliente  @relation(fields: [clienteId], references: [id])
  ingresso       Ingresso @relation(fields: [ingressoId], references: [id])
  
  @@map("vendas")
}

model Notificacao {
  id          String   @id @default(cuid())
  clienteId   String
  titulo      String
  mensagem    String
  tipo        String   @default("info") // info, success, warning, error
  lida        Boolean  @default(false)
  link        String?  // Link opcional para ação relacionada
  createdAt   DateTime @default(now())
  
  cliente     Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  
  @@map("notificacoes")
  @@index([clienteId])
  @@index([lida])
}

